
{% extends 'base.html' %}
{% load static %}

{%block customcss%}
  <link href="{% static 'css/style.css' %}" rel="stylesheet">
{% endblock %}

{% block pagecontent %}
  {% block pageheading %}
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Welcome</h1>
        <!-- <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a> -->
    </div>
  {% endblock %}
  {% block rows %}
      <div class="row">
          <div id="alert-box" class="col-lg-9 mb-4">
              <div class="card bg-danger text-white shadow" style="display: none">
                  <div class="card-body">
                      Danger
                      <div class="text-white-50 small">#e74a3b</div>
                  </div>
              </div>
          </div>
      </div>
      <div class="row">
          <!-- Card Form -->
          <div class="col-xl-12 col-md-12 mb-12">
              <div class="card border-left-primary shadow h-100 py-2">
                  <div class="card-body">
                    <form class="user" enctype="multipart/form-data" id="upload-form" action="{% url 'index' %}" method="POST" onsubmit="spinner()" enctype="multipart/form-data">
                      {% csrf_token %}
                      <h1 class="h3 mb-0 text-gray-800">User Information</h1>
                      <hr class="sidebar-divider my-0"><br>
                      <div class="row align-items-center">
                        <div class="col mr-6">
                            <div class="form-group">
                                <label for="fileFasta" class="form-label">{{ form.name.label }}</label>
                                {{ form.name }}
                            </div>
                        </div>
                        <div class="col mr-6">
                            <div class="form-group">
                                <label for="fileFasta" class="form-label">{{ form.email.label }}</label>
                                {{ form.email }}
                            </div>
                        </div>
                      </div><br>
                      <h1 class="h3 mb-0 text-gray-800">Input Files</h1>
                      <hr class="sidebar-divider my-0"><br>
                      <div class="row align-items-center">
                        <div class="col mr-2">
                            <!-- Input FASTA -->
                            <div class="form-group">
                                <label for="fileFasta" class="form-label">{{ form.fileFasta.label }}</label><br>
                                <div class="file-drop-area col col-xl-6">
                                  <span class="choose-file-button">Choose files</span>
                                  <span class="file-message">or drag and drop files here</span>
                                  {{ form.fileFasta }}
                                </div>
                            </div>
                        </div>
                        <div class="col mr-2">
                            <!-- Input fileGBK -->
                            <div class="form-group">
                                <label for="fileGBK" class="form-label">{{ form.fileGBK.label }}</label><br>
                                <div class="file-drop-area">
                                  <span class="choose-file-button">Choose files</span>
                                  <span class="file-message">or drag and drop files here</span>
                                  {{ form.fileGBK }}
                                </div>
                            </div>
                        </div>
                      </div><br>
                      <hr class="sidebar-divider my-0"><br>
                      <div class="row align-items-center">
                          <!-- Spinner -->
                          <br><br><br>
                          <div class="form-group" id="spinner" style="display: none">
                            <button class="col-xl-2 col-md-2 mb-1 btn btn-primary btn-user btn-block" type="button" disabled>
                              <span class="spinner-grow spinner-grow-sm btn-primary" role="status" aria-hidden="true"></span>
                              Loading...
                            </button>
                          </div>
                          <div class="form-group" id="submit">
                            <input class="col-xl-2 col-md-2 mb-1 btn btn-primary btn-user btn-block" type="submit" value="Upload"/>
                          </div>
                          
                          <!-- <div class="progress" id="progress_div">
                            <div class="progress-bar" id="progress_bar" role="progressbar" aria-label="Example with label" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                          </div> -->
                    </form>
                  </div>
                  <span id="labelbar"></span>
                  <div class="progress mr-2" id="progress_div" style="display: none">
                    <div class="progress-bar bg-info" id="progress_bar"  role="progressbar" aria-label="Example with label" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
              </div>
              <!-- <button id="upload-btn">Upload</button> -->
          </div>
      </div>
  {% endblock %}
{% endblock %}

{% block customjs %}
<script>
  $(document).on('change', '.file-input', function() {
    var filesCount = $(this)[0].files.length;
    var files = $(this)[0].files;
    const namesfiles = [];

    var textbox = $(this).prev();

    if (filesCount === 1) {
      var fileName = $(this).val().split('\\').pop();
      textbox.text(fileName);
    } else {
      textbox.text(filesCount + ' files selected');
      for (var i = 0; i < filesCount; i++) {
        // var fileName = $(this).val().split('\\').pop();

        // obtÃ©m o item
        file = files.item(i);
        namesfiles[i] = file.name;
        
      }
    }
  });

  function upload___(){
    var fileInput = document.getElementById('id_fileFasta');
    var files = fileInput.files;
    var progress = document.getElementById('progress');
    var label = document.getElementById('label');


    for (var i = 0; i < files.length; i++) {
        var file = files[i];

        var formData = new FormData();
        formData.append('file', file);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '');

        // var progressContainer = document.querySelector('#progress-template').content.cloneNode(true);
        // progressContainer.querySelector('.filename').textContent = file.name;
        // var progress = progressContainer.querySelector('progress');

        xhr.upload.addEventListener('progress', function(event) {
          progress.value = event.loaded / event.total * 100;
        });

        xhr.onloadend = function() {
        if (xhr.status === 200) {
            console.log('File uploaded successfully.');
        } else {
            console.error('File upload failed.');
        }
        };

        xhr.send(formData);
        // document.body.appendChild(progressContainer);
    }
  }

  function upload(){
    var fileInput = document.getElementById('id_fileFasta');
    var fileImput2 = document.getElementById('id_fileGBK');
    var files = fileInput.files;
    var files2 = fileImput2.files;
    var formData = new FormData();
    
    for (i=0 ; i < files.length ; i++){
      var file = files[i];
      formData.append('file'+i, files.item(i));
      formData.append('file2'+i, files2.item(i));
      console.log(formData);

      var xhr = new XMLHttpRequest();
      xhr.open('POST', '');
      xhr.upload.addEventListener("progress", function(ev){
        if (ev.lengthComputable){
          var percentage = (ev.loaded/ev.total * 100|0);
          $("#progress_div").show();
          document.getElementById('progress_bar').style["width"]=""+percentage+"%";
          document.getElementById('progress_bar').innerHTML=""+percentage+"%";
          document.getElementById('labelbar').innerHTML="Uploaded: "+parseInt(ev.loaded/1000000)+"/"+parseInt(ev.total/1000000)+" MB";
          console.log('Uploaded: ' + (percentage) +'%');
        }
      },false);
      xhr.send(formData);
    } 
  }

  document.getElementById('upload-btn').addEventListener('click', function(){
    var fileInput = document.getElementById('id_fileFasta');
    var files = fileInput.files;
    var formData = new FormData();
    
    for (i=0 ; i < files.length ; i++){
      var file = files[i];
      formData.append('file'+i, files.item(i));
      console.log(formData);
      console.log('file'+i);
      console.log(files[i].name)

      var xhr = new XMLHttpRequest();
      xhr.open('POST', '');
      xhr.upload.addEventListener("progress", function(ev){
        if (ev.lengthComputable){
          // console.log("Uploaded: "+ ev.loaded)
          // console.log("Total: "+ ev.total)
          var percentage = (ev.loaded/ev.total * 100|0);
          document.getElementById('progress_bar').style["width"]=""+percentage+"%";
          document.getElementById('progress_bar').innerHTML=""+percentage+"%";
          document.getElementById('labelbar').innerHTML="Uploaded: "+parseInt(ev.loaded/1000000)+"/"+parseInt(ev.total/1000000)+" MB";
          console.log('Uploaded: ' + (percentage) +'%');
        }
      },false);
      xhr.send(formData);
    } 

  });
</script>
<script type="text/javascript">
  function spinner(){
    $("#spinner").show();
    $("#submit").hide();
    upload();
  }

  function exibir_ocultar(){
    var valor = $("#params").val();

    if(valor == 1){
         $("#custom_params").show();
         $("#paramDefault").hide();
     } else {
         $("#custom_params").hide();
         $("#paramDefault").show();
     };



     // Resultado em tempo Real do Range
     let $range2 = document.querySelector('#dMaxRangeInput'),
         $value2 = document.querySelector('#dMaxRangeValue'),
         $radio = document.querySelector('input[name="generate_Alignment"]:checked').value;
         alert(radio);

     $radio.addEventListener('input', function(){
       alert(this.value);
     });

     $range2.addEventListener('input', function() {
         $value2.textContent = this.value;
     });



     // selector = document.
     // element = $(selector);

     // alert(selector);
  }
</script>
<!-- <script>
  var upload_form = document.getElementById('upload-form');
  var input_files = document.getElementById('id_fileFasta');
  var progressbar = document.getElementById('progressbar')
  
  $("#upload_form").submit(function(e){
    e.preventDefault();
    $form = $(this);
    var formData = new FormData(this)
    const media_data = input_files.files[0];
    if(media_data != null){

    }

    $.ajax({
      type: 'POST',
      url:'/',
      data: formData,
      dataType: 'json',
      beforeSend: function(){

      },
      xhr: function(){
        const xhr = new window.XMLHttpRequest();
        xhr.upload.addEventListener('progress', e=>{
          console.log(e);
        });
        return xhr

      },
      success: function(response){

      },
      error: function(err){
        console.log(err);
      },
      cache: false,
      contentType: false,
      processData: false
    });
  });


</script> -->
{% endblock %}
